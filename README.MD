# jansson library for Bosch XDK
### Introduction
This is a modified version of the [jansson JSON library](https://github.com/akheron/jansson) for [Bosch XDK](https://xdk.bosch-connectivity.com/) made to work in [XDK Workbench](https://xdk.bosch-connectivity.com/software-downloads).

### Differences
This version was stripped of file handling functions (i.e. JSONs can't be loaded and stored in files directly, it's still possible to dump JSON into a string and store it on SD card using libraries avalaible in the XDK SDK). Furthermore the hashtable seed is generated by calling [**xTaskGetTickCount**](https://www.freertos.org/a00021.html#xTaskGetTickCount) from [FreeRTOS](https://www.freertos.org/index.html) API.

### Compilation and Installation
Compilation requires the arm-none-eabi toolchaon to be avalaible in PATH. To compile run the attached bash script.
```bash
git clone https://github.com/m-drozd/jansson
cd jansson
./compile.sh
```
This will generate a build directory, inside which a jansson directory will be located. This directory needs to be placed in your XDK SDK location. If XDK-Workbench was installed in /opt catalogue you can use the following command.
```bash
cp -r build/jansson /opt/XDK-Workbench/XDK/SDK/xdk110/Libraries/
```

Now you need to edit the **application.mk** makefile located in:
```
{Workbench dir}/XDK/SDK/xdk110/Common/application.mk
```

Add the following line at the end of <span style="color:green">#XDK application specific Paths</span> section: 
```
OWN_LIBRARIES_DIR= $(BCDS_LIBRARIES_PATH)/jansson
```
Now scroll to the end of <span style="color:green">BCDS_XDK_EXT_INCLUDES</span> and add the following line:
```
-isystem $(OWN_LIBRARIES_DIR)/include \
```

Make sure that the line before the one you added ends with a backslash.

Now navigate to the **Libraries.mk** file in the same directory. At the end of the <span style="color:green">BCDS_THIRD_PARTY_LIBS</span> section add the following lines:
```
    $(OWN_LIBRARIES_DIR)/source/dump.a \
    $(OWN_LIBRARIES_DIR)/source/error.a \
    $(OWN_LIBRARIES_DIR)/source/hashtable.a \
    $(OWN_LIBRARIES_DIR)/source/hashtable_seed.a \
    $(OWN_LIBRARIES_DIR)/source/load.a \
    $(OWN_LIBRARIES_DIR)/source/memory.a \
    $(OWN_LIBRARIES_DIR)/source/pack_unpack.a \
    $(OWN_LIBRARIES_DIR)/source/strconv.a \
    $(OWN_LIBRARIES_DIR)/source/utf.a \
    $(OWN_LIBRARIES_DIR)/source/value.a \
    $(OWN_LIBRARIES_DIR)/source/strbuffer.a \
```
Again make sure that the line before the ones that you've added ends with a backslash.

It should now be possible to use the jansson library from the XDK Workbench IDE.
